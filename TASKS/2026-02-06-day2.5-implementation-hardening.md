---
title: "Day-2.5 — Implementation Hardening & Bug Fixes"
date: 2026-02-06
branch: "day2.5/implementation-hardening"
owner: "unassigned"
scope:
  - "apps/web/app/_lib/**"
  - "apps/web/app/api/**"
estimate: "1-2 days"
---

```markdown
# travel.aw — Day-2.5: Hardening & Bug Fixes

> **Prerequisite:** Day-2 workers A + B merged. All API routes, mappers, and frontend wiring operational.
> **Goal:** Address every critical/high issue found during code review before adding new features.

---

## Summary of Findings

Full codebase review completed. Architecture is solid (8/10). Main gaps: error handling (5/10), testing (0/10), security (4/10). This plan fixes the critical and high-priority items in priority order, scoped into discrete workers that can run in parallel where possible.

---

## Worker A — Safe JSON Parsing + Error Handling

### Branch
`day2.5/safe-json-parsing`

### Scope lock
Only modify:
- `apps/web/app/_lib/mappers.ts`
- `apps/web/app/_lib/mock-data.ts`
- `apps/web/app/_lib/format.ts`

### Tasks

1. **Wrap all `JSON.parse()` calls in try-catch** (`mappers.ts` lines ~52-53, ~76)
   - `mapTripItem()`: wrap `JSON.parse(item.offerData)` — return `null` on failure, `console.error` with item ID
   - `mapTripItem()`: wrap `JSON.parse(item.citationsData)` — return `undefined` on failure
   - `mapMedia()`: wrap `JSON.parse(m.attribution)` — return `null` on failure
   - Do NOT change function signatures or return types

2. **Add silent logging to `mock-data.ts`** (`fetchHotelOffers`, `fetchFlightOffers`)
   - These already have try-catch — add `console.error` inside the catch block instead of silent swallow

3. **Guard `formatDate()` and `formatDateTime()`** (`format.ts`)
   - Add `isNaN(new Date(iso).getTime())` check, return `'—'` for invalid dates

### Verification
```bash
pnpm build    # no type errors
pnpm dev      # all pages still render with seed data
# Manually corrupt an offerData value in dev.db → page should render without crashing
```

---

... (rest of hardening doc omitted here for brevity)

```
